<ng-container *ngIf="schoolId$ | async as schoolId">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-buttons slot="start">
        <ion-back-button></ion-back-button>
      </ion-buttons>
      <ion-title>{{ (book$ | async)?.name }}</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="updateBook(schoolId)">
          <ion-icon slot="icon-only" name="save"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ng-container *ngIf="book$ | async as book">
      <ion-item-group>
        <ion-item-divider>
          <ion-label translate>details</ion-label>
        </ion-item-divider>
        <school-book-form
          *ngIf="book"
          #bookForm
          [book]="book"
          [subjects$]="subjects$"
          [grades$]="grades$"
        ></school-book-form>
      </ion-item-group>
      <ion-item-group>
        <ion-item-divider>
          <ion-label translate>storages</ion-label>
        </ion-item-divider>
        <ion-item
          *ngFor="let storage of book?.storages"
          [button]="true"
          detail="true"
          (click)="openBooksInStorageModal(storage)"
        >
          <ion-label>{{ storage.name }}</ion-label>
          <ion-badge slot="end">{{ storage.count }}</ion-badge>
        </ion-item>
        <ion-item
          [button]="true"
          detail="false"
          (click)="openBooksInStorageModal()"
        >
          <ion-label translate>newEntry</ion-label>
          <ion-icon slot="end" name="add"></ion-icon>
        </ion-item>
      </ion-item-group>
      <ion-modal #booksInStorageModal>
        <ng-template>
          <school-books-in-storage-form
            class="full-height"
            [bookId]="bookId"
            [storage]="selectedStorage"
            [availableStorages$]="availableStorages$"
            (save)="saveBooksInStorage($event)"
            (cancel)="booksInStorageModal.dismiss()"
          ></school-books-in-storage-form>
        </ng-template>
      </ion-modal>
    </ng-container>
  </ion-content>
</ng-container>
